<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSVP Gallery 2.0 - Construction Timeline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: "Neue Haas Grotesk", -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }
        .gantt-bar {
            height: 32px;
            border-radius: 16px;
            position: relative;
            transition: all 0.3s ease;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 500;
            color: white;
            border: 1px solid rgba(0,0,0,0.1);
            user-select: none;
            text-align: center;
            white-space: nowrap;
            text-overflow: ellipsis;
            padding: 0 8px;
            box-sizing: border-box;
        }
        .gantt-bar:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            cursor: grab;
        }
        .gantt-bar:active {
            cursor: grabbing;
        }
        .gantt-bar.dragging {
            cursor: grabbing;
            z-index: 1000;
            opacity: 0.8;
        }
        .resize-handle {
            position: absolute;
            right: -4px;
            top: 0;
            bottom: 0;
            width: 8px;
            cursor: ew-resize;
            background: rgba(255,255,255,0.3);
            border-radius: 0 16px 16px 0;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .gantt-bar:hover .resize-handle {
            opacity: 1;
        }
        .resize-handle:hover {
            background: rgba(255,255,255,0.5);
        }
        .milestone {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            top: 10px;
            right: -6px;
            border: 2px solid white;
            z-index: 10;
        }
        .phase-header {
            position: sticky;
            left: 0;
            z-index: 20;
            background-color: white;
            border-right: 1px solid #e5e7eb;
        }
        .gantt-container {
            overflow-x: auto;
            overflow-y: visible;
            scrollbar-width: thin;
            scrollbar-color: #9ca3af #f3f4f6;
            -webkit-overflow-scrolling: touch;
        }
        .gantt-container::-webkit-scrollbar {
            height: 6px;
        }
        .gantt-container::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
        .gantt-container::-webkit-scrollbar-thumb {
            background: #9ca3af;
        }
        .date-cell {
            min-width: 120px;
            height: 100%;
            border-right: 1px solid #e5e7eb;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
        }
        .date-cell:hover {
            background-color: #f9fafb;
        }
        .gantt-row {
            position: relative;
            min-height: 50px;
            width: 100%;
            overflow: visible;
            padding-right: 20px;
        }

        .task-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            opacity: 0;
        }
        .task-details.open {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
            opacity: 1;
        }
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.8s ease;
            background: currentColor;
        }
        .critical-path {
            border: 2px solid #dc2626;
            background: #dc2626;
        }
        .extended-phase {
            border: 2px solid #dc2626;
            background: #dc2626;
            position: relative;
        }
        .extended-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: #dc2626;
            border-radius: 50%;
            color: white;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 1px solid white;
        }
        .delay-warning {
            position: absolute;
            top: -20px;
            right: 0;
            background: #dc2626;
            color: #ffffff;
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }
        .risk-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: #dc2626;
            border-radius: 50%;
            color: white;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 1px solid white;
        }
        .task-row {
            transition: all 0.2s ease;
            overflow: visible;
        }
        .task-row:hover {
            background-color: #f9fafb;
        }
        .phase-divider {
            height: 1px;
            background: #e5e7eb;
            margin: 24px 0;
        }
        .budget-badge {
            font-size: 10px;
            padding: 4px 8px;
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            font-weight: 500;
        }
        .task-checkbox {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            accent-color: #1f2937;
            cursor: pointer;
        }
        .architect-task {
            accent-color: #6b7280;
        }
        .task-item {
            display: flex;
            align-items: center;
            padding: 6px 0;
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
        }
        .task-item:hover {
            background-color: #f9fafb;
            border-left: 2px solid #e5e7eb;
            padding-left: 8px;
        }
        .task-item.completed {
            text-decoration: line-through;
            opacity: 0.6;
            color: #059669;
        }
        .progress-animation {
            animation: progressPulse 0.5s ease-in-out;
        }
        @keyframes progressPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        .payment-milestone {
            position: relative;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #0ea5e9;
            border-radius: 0px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .payment-milestone:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
        }
        .payment-milestone.completed {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #22c55e;
        }
        .payment-milestone.completed:hover {
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }
        .payment-milestone.overdue {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #ef4444;
        }
        .impact-alert {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            // Show notification
            .gantt-bar {
                height: 28px;
                font-size: 10px;
            }
            .date-cell {
                min-width: 100px;
            }
            .task-checkbox {
                width: 20px;
                height: 20px;
                margin-right: 12px;
            }
            .task-item {
                padding: 12px 0;
                min-height: 44px;
            }
            .payment-milestone {
                padding: 16px;
                margin: 12px 0;
            }
            .gantt-container::-webkit-scrollbar {
                height: 8px;
            }
            input[type="date"], button {
                min-height: 44px;
                font-size: 16px;
            }
            .text-xs {
                font-size: 13px;
            }
            .text-sm {
                font-size: 15px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .date-cell {
                min-width: 110px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8">
            <div>
                <div class="flex flex-col sm:flex-row items-start sm:items-center mb-3">
                    <div class="mr-0 sm:mr-4 mb-3 sm:mb-0" style="height: 60px;">
                        <img src="https://artisanalmetals.com/wp-content/uploads/2025/07/chilab-logo-draft-2-copy.jpg" alt="ChiLab Studio" class="h-full w-auto object-contain">
                    </div>
                    <div>
                        <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">RSVP Gallery 2.0</h1>
                        <p class="text-gray-600">Retail Gallery Buildout</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 text-sm">
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>
                        <span class="break-words">212 N Aberdeen Street, Chicago</span>
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-ruler-combined mr-2 text-yellow-500"></i>
                        3,855 Square Feet
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-dollar-sign mr-2 text-green-500"></i>
                        $450,000 Budget
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-calendar mr-2 text-red-500"></i>
                        <span id="total-duration">18 Week Duration</span>
                    </div>
                </div>
            </div>
            <div class="mt-6 lg:mt-0">
                <div class="bg-white p-6 border border-gray-300">
                    <div class="text-sm space-y-2">
                        <div>
                            <div class="font-medium text-gray-900">Project Architect</div>
                            <div class="text-gray-600">Norman Kelley Architecture</div>
                        </div>
                        <div>
                            <div class="font-medium text-gray-900">General Contractor</div>
                            <div class="text-gray-600">ChiLab Studio LLC</div>
                        </div>
                        <div>
                            <div class="font-medium text-gray-900">Subcontractor</div>
                            <div class="text-gray-500">Max Davis Group</div>
                        </div>
                        <div class="mt-4 pt-2 border-t border-gray-200">
                            <a href="https://artisanalmetals.com/wp-content/uploads/2025/07/250604-212-n-aberdeen-arch-pricing-set.pdf" 
                               target="_blank" 
                               class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-file-pdf mr-2"></i>
                                Issue for Construction
                                <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule Impact Alert -->
        <div id="impact-alert" class="impact-alert hidden">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-amber-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-amber-800 mb-2">Schedule Impact Detected</h3>
                    <div id="impact-details" class="text-sm text-amber-700 space-y-1">
                        <!-- Impact details will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Overview -->
        <div class="bg-white border border-gray-300 overflow-hidden mb-8">
            <div class="p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 sm:mb-0">Project Progress Overview</h2>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
                        <span class="text-sm font-medium text-gray-600">0%</span>
                        <div class="w-full sm:w-72 bg-gray-200 h-3">
                            <div id="overall-progress" class="h-3 bg-gray-900 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-600">100%</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-5 border border-blue-200 relative">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-semibold text-blue-800">Phase 1</h3>
                            <div class="flex items-center gap-2">
                                <span id="phase-1-status-badge" class="text-xs bg-blue-200 text-blue-800 px-2 py-1">Planned</span>
                                <i id="phase-1-extended-flag" class="fas fa-flag text-red-500 hidden" title="Schedule Extended"></i>
                            </div>
                        </div>
                        <p class="text-sm text-blue-700 mb-3">Permits & Pre-Construction</p>
                        <div id="phase-1-weeks" class="text-xs text-blue-600 mb-2">TBD</div>
                        <div class="progress-bar mb-2">
                            <div id="phase-1-progress" class="progress-fill bg-blue-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="budget-badge">$50,000</span>
                            <span id="phase-1-status" class="text-xs text-blue-600">0 of 13 tasks</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-5 border border-green-200 relative">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-semibold text-green-800">Phase 2</h3>
                            <div class="flex items-center gap-2">
                                <span id="phase-2-status-badge" class="text-xs bg-red-200 text-red-800 px-2 py-1">Critical</span>
                                <i id="phase-2-extended-flag" class="fas fa-flag text-red-500 hidden" title="Schedule Extended"></i>
                            </div>
                        </div>
                        <p class="text-sm text-green-700 mb-3">Sub-Slab MEP & Concrete</p>
                        <div id="phase-2-weeks" class="text-xs text-green-600 mb-2">TBD</div>
                        <div class="progress-bar mb-2">
                            <div id="phase-2-progress" class="progress-fill bg-green-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="budget-badge">$85,000</span>
                            <span id="phase-2-status" class="text-xs text-red-600"><i class="fas fa-exclamation-triangle mr-1"></i>0 of 8 tasks</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-5 border border-yellow-200 relative">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-semibold text-yellow-800">Phase 3</h3>
                            <div class="flex items-center gap-2">
                                <span id="phase-3-status-badge" class="text-xs bg-yellow-200 text-yellow-800 px-2 py-1">Planned</span>
                                <i id="phase-3-extended-flag" class="fas fa-flag text-red-500 hidden" title="Schedule Extended"></i>
                            </div>
                        </div>
                        <p class="text-sm text-yellow-700 mb-3">Framing & Above-Slab MEP</p>
                        <div id="phase-3-weeks" class="text-xs text-yellow-600 mb-2">TBD</div>
                        <div class="progress-bar mb-2">
                            <div id="phase-3-progress" class="progress-fill bg-yellow-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="budget-badge">$170,000</span>
                            <span id="phase-3-status" class="text-xs text-yellow-600">0 of 8 tasks</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-5 border border-orange-200 relative">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-semibold text-orange-800">Phase 4</h3>
                            <div class="flex items-center gap-2">
                                <span id="phase-4-status-badge" class="text-xs bg-orange-200 text-orange-800 px-2 py-1">Planned</span>
                                <i id="phase-4-extended-flag" class="fas fa-flag text-red-500 hidden" title="Schedule Extended"></i>
                            </div>
                        </div>
                        <p class="text-sm text-orange-700 mb-3">Finishes & Custom Elements</p>
                        <div id="phase-4-weeks" class="text-xs text-orange-600 mb-2">TBD</div>
                        <div class="progress-bar mb-2">
                            <div id="phase-4-progress" class="progress-fill bg-orange-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="budget-badge">$115,000</span>
                            <span id="phase-4-status" class="text-xs text-orange-600">0 of 8 tasks</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-5 border border-purple-200 relative">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-semibold text-purple-800">Phase 5</h3>
                            <div class="flex items-center gap-2">
                                <span id="phase-5-status-badge" class="text-xs bg-purple-200 text-purple-800 px-2 py-1">Planned</span>
                                <i id="phase-5-extended-flag" class="fas fa-flag text-red-500 hidden" title="Schedule Extended"></i>
                            </div>
                        </div>
                        <p class="text-sm text-purple-700 mb-3">Final Completion</p>
                        <div id="phase-5-weeks" class="text-xs text-purple-600 mb-2">TBD</div>
                        <div class="progress-bar mb-2">
                            <div id="phase-5-progress" class="progress-fill bg-purple-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="budget-badge">$30,000</span>
                            <span id="phase-5-status" class="text-xs text-purple-600">0 of 8 tasks</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Controls -->
        <div class="bg-white border border-gray-300 overflow-hidden mb-8">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Timeline Management</h2>
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center space-y-4 lg:space-y-0">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full lg:w-auto">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Project Start Date</label>
                            <input type="date" id="start-date" class="w-full border border-gray-300 px-3 py-2 focus:outline-none focus:border-gray-900">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Progress Display</label>
                            <div class="text-lg font-semibold text-gray-900"><span id="progress-display">0%</span> Complete</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Project End Date</label>
                            <div class="text-lg font-semibold text-gray-900" id="end-date-display">TBD</div>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-3 w-full lg:w-auto">
                        <button id="reset-timeline" class="w-full sm:w-auto px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white hover:from-amber-600 hover:to-amber-700 focus:outline-none transition-colors rounded-lg">
                            <i class="fas fa-undo mr-2"></i>Reset Timeline
                        </button>
                        <button id="reset-progress" class="w-full sm:w-auto px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 focus:outline-none transition-colors rounded-lg">
                            <i class="fas fa-undo mr-2"></i>Reset Progress
                        </button>
                        <button onclick="window.print()" class="w-full sm:w-auto px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white hover:from-gray-600 hover:to-gray-700 focus:outline-none transition-colors rounded-lg">
                            <i class="fas fa-print mr-2"></i>Print
                        </button>
                        <button id="export-timeline" class="w-full sm:w-auto px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700 focus:outline-none transition-colors rounded-lg">
                            <i class="fas fa-file-pdf mr-2"></i>Export PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Critical Path Alert -->
        <div class="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 p-5 mb-8">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-red-800 mb-2">Critical Timeline Risk</h3>
                    <div class="text-sm text-red-700 space-y-1">
                        <p><strong>Architect Coordination:</strong> Norman Kelley Architecture handles permit submissions. GC maintains communication regarding permit status.</p>
                        <p><strong>Critical Path:</strong> Sub-slab MEP completion must occur before concrete pour (Week 8).</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile scroll hint -->
        <div class="block sm:hidden bg-blue-50 border border-blue-200 p-3 mb-4 text-center">
            <i class="fas fa-arrows-alt-h mr-2 text-blue-600"></i>
            <span class="text-blue-700 text-sm">Swipe left/right to view full timeline</span>
        </div>

        <!-- Mobile interaction hint -->
        <div class="block sm:hidden bg-green-50 border border-green-200 p-3 mb-4 text-center">
            <i class="fas fa-hand-pointer mr-2 text-green-600"></i>
            <span class="text-green-700 text-sm">Tap and drag the right edge of timeline bars to adjust durations</span>
        </div>

        <!-- Gantt Chart -->
        <div class="bg-white shadow-md overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Interactive Project Timeline</h2>
                    <div class="hidden sm:flex items-center space-x-4 text-sm text-gray-600">
                        <div class="flex items-center">
                            <div class="w-3 h-3 border-2 border-red-500 bg-transparent rounded mr-2"></div>
                            <span>Critical Path</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-gradient-to-r from-red-400 to-red-500 rounded mr-2"></div>
                            <span>Extended Phase</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                            <span>Milestone</span>
                        </div>
                    </div>
                </div>
                


                <!-- Date Header -->
                <div class="gantt-container mb-4">
                    <div class="flex border-b-2 border-gray-200">
                        <div id="week-headers" class="flex min-w-max w-full" style="padding-right: 20px;">
                            <!-- Week headers will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Gantt Rows -->
                <div class="gantt-container">
                    <!-- Phase content will be dynamically generated -->
                    <div id="gantt-phases">
                        <!-- Phases will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Tracker -->
        <div class="bg-white border border-gray-300 overflow-hidden mb-8">
            <div class="p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-2 sm:mb-0">Payment Schedule & Progress</h2>
                    <div class="text-sm text-gray-600">
                        Total Contract Value: <span class="font-semibold text-gray-900">$450,000</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4" id="payment-milestones">
                    <!-- Payment milestones will be populated by JavaScript -->
                </div>

                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Total Payments Received:</span>
                        <span id="total-payments" class="font-semibold text-gray-900">$0</span>
                    </div>
                    <div class="flex justify-between items-center text-sm mt-1">
                        <span class="text-gray-600">Remaining Balance:</span>
                        <span id="remaining-balance" class="font-semibold text-gray-900">$450,000</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-sm text-gray-500 mt-8 p-4 bg-white shadow-sm">
            <p class="mb-2">© 2025 ChiLab Studio LLC • General Contractor • Max Davis Group Subcontractor Support</p>
            <p>RSVP 2.0 Project Tracker • Last Updated: <span id="last-updated"></span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            document.getElementById('last-updated').textContent = new Date().toLocaleDateString();

            // Project data structure with original durations
            const projectData = {
                totalTasks: 45,
                originalTotalWeeks: 18,
                phases: {
                    1: { 
                        name: 'Permits & Pre-Construction', 
                        totalTasks: 13, 
                        completedTasks: 0, 
                        originalDuration: 4,
                        currentDuration: 4,
                        startWeek: 1,
                        isCritical: false,
                        budget: '$50,000',
                        color: 'blue'
                    },
                    2: { 
                        name: 'Sub-Slab MEP & Concrete', 
                        totalTasks: 8, 
                        completedTasks: 0,
                        originalDuration: 4,
                        currentDuration: 4,
                        startWeek: 5,
                        isCritical: true,
                        budget: '$85,000',
                        color: 'green'
                    },
                    3: { 
                        name: 'Framing & Above-Slab MEP', 
                        totalTasks: 8, 
                        completedTasks: 0,
                        originalDuration: 4,
                        currentDuration: 4,
                        startWeek: 9,
                        isCritical: false,
                        budget: '$170,000',
                        color: 'yellow'
                    },
                    4: { 
                        name: 'Finishes & Custom Elements', 
                        totalTasks: 8, 
                        completedTasks: 0,
                        originalDuration: 4,
                        currentDuration: 4,
                        startWeek: 13,
                        isCritical: false,
                        budget: '$115,000',
                        color: 'orange'
                    },
                    5: { 
                        name: 'Final Completion', 
                        totalTasks: 8, 
                        completedTasks: 0,
                        originalDuration: 2,
                        currentDuration: 2,
                        startWeek: 17,
                        isCritical: false,
                        budget: '$30,000',
                        color: 'purple'
                    }
                }
            };

            // Payment tracking
            const paymentMilestones = [
                { id: 'payment-1', amount: 45000, percentage: 10, week: 0, description: 'Contract Execution', timing: 'Upon signing' },
                { id: 'payment-2', amount: 112500, percentage: 25, week: 4, description: 'Material Orders', timing: 'Week 4' },
                { id: 'payment-3', amount: 112500, percentage: 25, week: 11, description: 'Rough-in Complete', timing: 'Week 11' },
                { id: 'payment-4', amount: 112500, percentage: 25, week: 17, description: 'Substantial Completion', timing: 'Week 17' },
                { id: 'payment-5', amount: 67500, percentage: 15, week: 18, description: 'Final Completion', timing: 'Week 18' }
            ];

            let totalPaid = 0;

            // Initialize the timeline
            function initializeTimeline() {
                generateWeekHeaders();
                generateGanttChart();
                generatePaymentMilestones();
                updateProgress();
                updatePaymentDisplay();
                setupEventListeners();
            }

            // Generate week headers with work week dates (Monday-Friday)
            function generateWeekHeaders() {
                const totalWeeks = getTotalWeeks();
                const weekHeaderContainer = document.getElementById('week-headers');
                weekHeaderContainer.innerHTML = '';
                
                const startDateInput = document.getElementById('start-date');
                const hasStartDate = startDateInput.value;
                
                for (let i = 0; i < totalWeeks; i++) {
                    const weekCell = document.createElement('div');
                    weekCell.className = 'date-cell flex flex-col items-center justify-center px-3 py-2 text-xs font-medium text-gray-600 bg-gray-50 border-r border-gray-200';
                    
                    let weekLabel = 'TBD';
                    let dateLabel = 'TBD';
                    let phaseLabel = `Phase ${getPhaseForWeek(i + 1)}`;
                    
                    if (hasStartDate) {
                        const startDate = new Date(startDateInput.value);
                        
                        // Calculate the Monday of the work week
                        const weekStartDate = new Date(startDate);
                        weekStartDate.setDate(startDate.getDate() + (i * 7));
                        
                        // Adjust to Monday if not already Monday (0 = Sunday, 1 = Monday, etc.)
                        const dayOfWeek = weekStartDate.getDay();
                        const daysToMonday = dayOfWeek === 0 ? 1 : (dayOfWeek === 1 ? 0 : 8 - dayOfWeek);
                        weekStartDate.setDate(weekStartDate.getDate() - dayOfWeek + 1);
                        
                        // Calculate Friday of the same week
                        const weekEndDate = new Date(weekStartDate);
                        weekEndDate.setDate(weekStartDate.getDate() + 4);
                        
                        weekLabel = `Week ${i + 1}`;
                        
                        // Format as M/D - M/D
                        const startMonth = weekStartDate.getMonth() + 1;
                        const startDay = weekStartDate.getDate();
                        const endMonth = weekEndDate.getMonth() + 1;
                        const endDay = weekEndDate.getDate();
                        
                        dateLabel = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
                    }
                    
                    weekCell.innerHTML = `
                        <div class="font-bold text-gray-700">${weekLabel}</div>
                        <div class="text-gray-500 mt-1">${dateLabel}</div>
                        <div class="text-gray-400 text-xs mt-1">${phaseLabel}</div>
                    `;
                    
                    weekHeaderContainer.appendChild(weekCell);
                }
                
                // Update total duration display
                document.getElementById('total-duration').textContent = `${totalWeeks} Week Duration`;
            }



            // Save and restore checkbox states when regenerating
            function saveCheckboxStates() {
                const states = {};
                document.querySelectorAll('.task-checkbox, .architect-task').forEach(checkbox => {
                    const phase = checkbox.getAttribute('data-phase');
                    const task = checkbox.getAttribute('data-task');
                    if (phase && task) {
                        if (!states[phase]) states[phase] = {};
                        states[phase][task] = checkbox.checked;
                    }
                });
                return states;
            }

            function restoreCheckboxStates(states) {
                Object.keys(states).forEach(phase => {
                    Object.keys(states[phase]).forEach(task => {
                        const checkbox = document.querySelector(`[data-phase="${phase}"][data-task="${task}"]`);
                        if (checkbox && states[phase][task]) {
                            checkbox.checked = true;
                            const taskItem = checkbox.closest('.task-item');
                            if (taskItem) {
                                taskItem.classList.add('completed');
                            }
                        }
                    });
                });
                
                // Update progress bars after restoring states
                updateProgress();
            }

            function getPhaseTaskDetails(phaseNum, phase, isExtended) {
                const taskData = {
                    1: {
                        sections: [
                            {
                                title: 'Permits & Documentation',
                                icon: 'fas fa-file-alt',
                                note: 'Note: Permit submissions are handled by Norman Kelley Architecture. GC coordinates and tracks progress.',
                                tasks: [
                                    { id: 'submit-building-permit', text: 'Submit building permit application', architect: true },
                                    { id: 'submit-trade-permits', text: 'Submit all trade permit applications', architect: true },
                                    { id: 'zoning-compliance', text: 'Coordinate zoning compliance verification', architect: true },
                                    { id: 'insurance-bonding', text: 'Insurance certificates and bonding', architect: false },
                                    { id: 'contract-execution', text: 'Contract execution and project setup', architect: false }
                                ]
                            },
                            {
                                title: 'Pre-Construction Activities',
                                icon: 'fas fa-tools',
                                tasks: [
                                    { id: 'conditions-survey', text: 'Conduct existing conditions survey', architect: false },
                                    { id: 'temp-utilities', text: 'Establish temporary utilities', architect: false },
                                    { id: 'construction-trailer', text: 'Set up construction trailer/office', architect: false },
                                    { id: 'order-materials', text: 'Order long-lead materials (storefront - 12-16 weeks)', architect: false, important: true },
                                    { id: 'preconstruction-meeting', text: 'Schedule pre-construction meeting', architect: false },
                                    { id: 'permit-processing', text: 'Week 2: Monitor permit processing & material procurement', architect: false },
                                    { id: 'site-preparation', text: 'Week 3: Complete site preparation & labor planning', architect: false },
                                    { id: 'permit-approvals', text: 'Week 4: Obtain permit approvals & final preparations', architect: false }
                                ]
                            }
                        ]
                    },
                    2: {
                        sections: [
                            {
                                title: 'Critical Activities',
                                icon: 'fas fa-exclamation-triangle',
                                tasks: [
                                    { id: 'storefront-demo', text: 'Week 5: Storefront demo & site prep', architect: false },
                                    { id: 'subslab-mep-phase1', text: 'Week 6: Sub-slab MEP rough-in Phase 1', architect: false },
                                    { id: 'subslab-inspection', text: 'Week 7: Sub-slab inspection & approval', architect: false, important: true },
                                    { id: 'concrete-pour', text: 'Week 8: Landlord concrete slab pour', architect: false, important: true }
                                ]
                            },
                            {
                                title: 'Coordination Requirements',
                                icon: 'fas fa-handshake',
                                tasks: [
                                    { id: 'daily-coordination', text: 'Daily coordination with landlord\'s concrete contractor', architect: false },
                                    { id: 'mep-pass-required', text: 'Sub-slab MEP MUST pass inspection before concrete', architect: false, important: true },
                                    { id: 'truck-access', text: 'Maintain cement truck access throughout', architect: false },
                                    { id: 'cure-time', text: 'Monitor 28-day cure time before concrete sealer', architect: false }
                                ]
                            }
                        ]
                    },
                    3: {
                        sections: [
                            {
                                title: 'Framing & Structure',
                                icon: 'fas fa-hammer',
                                tasks: [
                                    { id: 'metal-stud-framing', text: 'Metal stud framing for new walls', architect: false },
                                    { id: 'door-window-openings', text: 'Door and window rough openings', architect: false },
                                    { id: 'framing-inspection', text: 'Framing inspection', architect: false },
                                    { id: 'drywall-installation', text: 'Drywall installation and finishing', architect: false }
                                ]
                            },
                            {
                                title: 'Above-Slab MEP',
                                icon: 'fas fa-plug',
                                tasks: [
                                    { id: 'electrical-circuits', text: 'Electrical circuits and outlets', architect: false },
                                    { id: 'plumbing-connections', text: 'Plumbing connections and fixtures', architect: false },
                                    { id: 'hvac-ductwork', text: 'HVAC ductwork installation', architect: false },
                                    { id: 'fire-protection', text: 'Fire protection rough-in', architect: false }
                                ]
                            }
                        ]
                    },
                    4: {
                        sections: [
                            {
                                title: 'Interior Finishes',
                                icon: 'fas fa-paint-brush',
                                tasks: [
                                    { id: 'interior-painting', text: 'Interior painting and trim work', architect: false },
                                    { id: 'mep-trimout', text: 'MEP trim-out and fixtures', architect: false },
                                    { id: 'concrete-sealer', text: 'Concrete sealer (after 28-day cure)', architect: false },
                                    { id: 'custom-millwork', text: 'Custom millwork installation', architect: false }
                                ]
                            },
                            {
                                title: 'Custom Elements',
                                icon: 'fas fa-wrench',
                                tasks: [
                                    { id: 'storefront-installation', text: 'Steel and glass storefront installation', architect: false },
                                    { id: 'security-bollards', text: 'Retractable bollards and security', architect: false },
                                    { id: 'hanging-rack-system', text: 'Stainless steel hanging rack system', architect: false },
                                    { id: 'leather-hardware', text: 'Leather-wrapped hardware details', architect: false }
                                ]
                            }
                        ]
                    },
                    5: {
                        sections: [
                            {
                                title: 'Testing & Inspections',
                                icon: 'fas fa-clipboard-check',
                                tasks: [
                                    { id: 'hvac-balancing', text: 'HVAC system balancing and testing', architect: false },
                                    { id: 'fire-protection-testing', text: 'Fire protection system testing', architect: false },
                                    { id: 'final-inspection', text: 'Final building inspection', architect: false },
                                    { id: 'punch-list', text: 'Punch list completion', architect: false }
                                ]
                            },
                            {
                                title: 'Project Handover',
                                icon: 'fas fa-key',
                                tasks: [
                                    { id: 'certificate-occupancy', text: 'Certificate of Occupancy', architect: false },
                                    { id: 'owner-walkthrough', text: 'Owner walkthrough and training', architect: false },
                                    { id: 'key-turnover', text: 'Key and document turnover', architect: false },
                                    { id: 'final-cleaning', text: 'Final cleaning and closeout', architect: false }
                                ]
                            }
                        ]
                    }
                };

                const phaseData = taskData[phaseNum];
                if (!phaseData) return '';

                let html = '<div class="grid md:grid-cols-2 gap-6 p-6">';
                
                phaseData.sections.forEach(section => {
                    html += `
                        <div class="bg-${phase.color}-50 p-5 border border-${phase.color}-100">
                            <h4 class="font-semibold text-${phase.color}-800 mb-3 flex items-center">
                                <i class="${section.icon} mr-2"></i>
                                ${section.title}
                            </h4>
                    `;
                    
                    if (section.note) {
                        html += `
                            <div class="mb-3 p-3 bg-purple-50 border border-purple-200">
                                <p class="text-xs text-purple-700 font-medium">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    ${section.note}
                                </p>
                            </div>
                        `;
                    }
                    
                    html += '<div class="space-y-2 text-sm text-' + phase.color + '-700">';
                    
                    section.tasks.forEach(task => {
                        const taskClass = task.architect ? 'architect-task' : 'task-checkbox';
                        const badge = task.architect ? '<span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded-full ml-2">Architect</span>' : '';
                        const emphasis = task.important ? '<strong>' : '';
                        const emphasisEnd = task.important ? '</strong>' : '';
                        
                        html += `
                            <div class="task-item">
                                <input type="checkbox" class="${taskClass}" data-phase="${phaseNum}" data-task="${task.id}">
                                <span>${emphasis}${task.text}${emphasisEnd} ${badge}</span>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                });
                
                if (isExtended) {
                    html += `
                        <div class="md:col-span-2 mt-3 p-3 bg-red-50 border border-red-200 rounded">
                            <p class="text-sm text-red-700">
                                <strong>Timeline Extended:</strong> This phase has been extended by ${phase.currentDuration - phase.originalDuration} week(s) beyond the original schedule.
                            </p>
                        </div>
                    `;
                }
                
                html += '</div>';
                return html;
            }

            function generateGanttChart() {
                const ganttPhasesContainer = document.getElementById('gantt-phases');
                ganttPhasesContainer.innerHTML = '';
                
                const totalWeeks = getTotalWeeks();
                
                Object.keys(projectData.phases).forEach(phaseNum => {
                    const phase = projectData.phases[phaseNum];
                    const isExtended = phase.currentDuration > phase.originalDuration;
                    const endWeek = phase.startWeek + phase.currentDuration - 1;
                    
                    const phaseDiv = document.createElement('div');
                    phaseDiv.className = 'mb-8';
                    
                    // Calculate position and width for Gantt bar (reserve 2% for graphics)
                    const effectiveWidth = 98; // Use 98% to leave room for milestone/alert graphics
                    const leftPercent = ((phase.startWeek - 1) / totalWeeks) * effectiveWidth;
                    const widthPercent = (phase.currentDuration / totalWeeks) * effectiveWidth;
                    
                    // Get formatted date ranges
                    const dateRangeText = getPhaseDisplayDates(phase.startWeek, endWeek);
                    
                    phaseDiv.innerHTML = `
                        <div class="flex items-center mb-4 p-3 bg-${phase.color}-50 border border-${phase.color}-200">
                            <div class="w-4 h-8 bg-gradient-to-b from-${phase.color}-400 to-${phase.color}-600 mr-4"></div>
                            <div class="flex-grow">
                                <h3 class="text-lg font-semibold text-${phase.color}-800">Phase ${phaseNum}: ${phase.name}</h3>
                                <p class="text-sm text-${phase.color}-600">
                                    ${phase.isCritical ? 'Critical path activities' : 'Standard project activities'}
                                    ${isExtended ? ' - <span class="text-red-600 font-medium">Extended Timeline</span>' : ''}
                                </p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-${phase.color}-700">${dateRangeText}</div>
                                <div class="text-xs text-${phase.color}-600">${phase.budget} budget</div>
                                ${isExtended ? '<div class="text-xs text-red-600 font-medium">+' + (phase.currentDuration - phase.originalDuration) + ' weeks extended</div>' : ''}
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="task-row rounded-lg">
                                <div class="cursor-pointer task-toggle p-2 rounded-lg hover:bg-gray-50 mb-2" data-target="phase${phaseNum}-details">
                                    <div class="flex items-center mb-3">
                                        <i class="fas fa-caret-right mr-3 transition-transform text-${phase.color}-500"></i>
                                        <div>
                                            <div class="font-medium">${phase.name}</div>
                                            <div class="text-xs text-gray-500">${dateRangeText} (${phase.currentDuration} weeks)</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="gantt-row relative" style="min-height: 50px;">
                                    <div class="gantt-bar ${isExtended ? 'extended-phase' : `bg-gradient-to-r from-${phase.color}-400 to-${phase.color}-500`} ${phase.isCritical ? 'critical-path' : ''} absolute" 
                                         style="left: ${leftPercent}%; width: ${widthPercent}%;"
                                         data-phase="${phaseNum}"
                                         data-original-duration="${phase.originalDuration}"
                                         data-current-duration="${phase.currentDuration}">
                                        ${phase.name}
                                        <div class="milestone bg-blue-500"></div>
                                        ${isExtended ? '<div class="extended-indicator">!</div>' : (phase.isCritical ? '<div class="risk-indicator">!</div>' : '')}
                                        <div class="resize-handle" data-phase="${phaseNum}"></div>
                                    </div>
                                </div>
                                <div id="phase${phaseNum}-details" class="task-details ml-4 border-l-2 border-${phase.color}-200">
                                    ${getPhaseTaskDetails(phaseNum, phase, isExtended)}
                                </div>
                            </div>
                        </div>
                        ${phaseNum < 5 ? '<div class="phase-divider"></div>' : ''}
                    `;
                    
                    ganttPhasesContainer.appendChild(phaseDiv);
                });
                
                // Re-attach event listeners for task toggles
                attachTaskToggleListeners();
                updatePhaseDisplays();
                
                // Setup Gantt interactions after chart is generated
                setupGanttInteractions();
            }

            // Get formatted date range for phase display using work weeks
            function getPhaseDisplayDates(startWeek, endWeek) {
                const startDateInput = document.getElementById('start-date');
                if (!startDateInput.value) {
                    return `Weeks ${startWeek}-${endWeek}`;
                }
                
                const startDate = new Date(startDateInput.value);
                
                // Calculate Monday of start week
                const phaseStartDate = new Date(startDate);
                phaseStartDate.setDate(startDate.getDate() + ((startWeek - 1) * 7));
                // Adjust to Monday
                const startDayOfWeek = phaseStartDate.getDay();
                phaseStartDate.setDate(phaseStartDate.getDate() - startDayOfWeek + 1);
                
                // Calculate Friday of end week
                const phaseEndDate = new Date(startDate);
                phaseEndDate.setDate(startDate.getDate() + ((endWeek - 1) * 7));
                // Adjust to Monday first, then add 4 days to get Friday
                const endDayOfWeek = phaseEndDate.getDay();
                phaseEndDate.setDate(phaseEndDate.getDate() - endDayOfWeek + 1 + 4);
                
                // Format as M/D - M/D
                const startMonth = phaseStartDate.getMonth() + 1;
                const startDay = phaseStartDate.getDate();
                const endMonth = phaseEndDate.getMonth() + 1;
                const endDay = phaseEndDate.getDate();
                
                return `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            }

            // Generate payment milestones
            function generatePaymentMilestones() {
                const container = document.getElementById('payment-milestones');
                container.innerHTML = '';
                
                paymentMilestones.forEach((milestone, index) => {
                    const adjustedWeek = adjustPaymentMilestoneWeek(milestone.week);
                    const adjustedTiming = milestone.week === 0 ? milestone.timing : getPaymentMilestoneDate(adjustedWeek);
                    
                    const milestoneDiv = document.createElement('div');
                    milestoneDiv.className = 'payment-milestone';
                    milestoneDiv.setAttribute('data-milestone', milestone.id.split('-')[1]);
                    
                    milestoneDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-sm font-semibold text-blue-800">${milestone.description}</div>
                            <div class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${milestone.percentage}%</div>
                        </div>
                        <div class="text-lg font-bold text-blue-900 mb-1">$${milestone.amount.toLocaleString()}</div>
                        <div class="text-xs text-blue-600">${adjustedTiming}</div>
                        <div class="mt-2">
                            <input type="checkbox" id="${milestone.id}" class="payment-checkbox mr-2">
                            <label for="${milestone.id}" class="text-xs text-blue-700">Payment received</label>
                        </div>
                    `;
                    
                    container.appendChild(milestoneDiv);
                });
                
                // Re-attach payment event listeners
                attachPaymentListeners();
            }

            // Get payment milestone date using work week format
            function getPaymentMilestoneDate(week) {
                const startDateInput = document.getElementById('start-date');
                if (!startDateInput.value) {
                    return `Week ${week}`;
                }
                
                const startDate = new Date(startDateInput.value);
                const milestoneDate = new Date(startDate);
                milestoneDate.setDate(startDate.getDate() + ((week - 1) * 7));
                
                // Adjust to Monday of the work week
                const dayOfWeek = milestoneDate.getDay();
                milestoneDate.setDate(milestoneDate.getDate() - dayOfWeek + 1);
                
                // Format as M/D
                const month = milestoneDate.getMonth() + 1;
                const day = milestoneDate.getDate();
                
                return `${month}/${day}`;
            }

            // Get total weeks based on current phase durations
            function getTotalWeeks() {
                let maxWeek = 0;
                Object.values(projectData.phases).forEach(phase => {
                    const endWeek = phase.startWeek + phase.currentDuration - 1;
                    if (endWeek > maxWeek) {
                        maxWeek = endWeek;
                    }
                });
                return Math.max(maxWeek, projectData.originalTotalWeeks);
            }

            // Get phase number for a given week
            function getPhaseForWeek(week) {
                for (const [phaseNum, phase] of Object.entries(projectData.phases)) {
                    const endWeek = phase.startWeek + phase.currentDuration - 1;
                    if (week >= phase.startWeek && week <= endWeek) {
                        return phaseNum;
                    }
                }
                return '5'; // Default to last phase
            }

            // Adjust payment milestone weeks based on phase extensions
            function adjustPaymentMilestoneWeek(originalWeek) {
                if (originalWeek === 0) return 0; // Contract execution
                
                // Find which phase this milestone falls in and adjust accordingly
                let adjustedWeek = originalWeek;
                let cumulativeExtension = 0;
                
                Object.values(projectData.phases).forEach(phase => {
                    if (phase.startWeek <= originalWeek) {
                        cumulativeExtension += (phase.currentDuration - phase.originalDuration);
                    }
                });
                
                return adjustedWeek + cumulativeExtension;
            }

            // Update phase displays
            function updatePhaseDisplays() {
                Object.keys(projectData.phases).forEach(phaseNum => {
                    const phase = projectData.phases[phaseNum];
                    const isExtended = phase.currentDuration > phase.originalDuration;
                    const endWeek = phase.startWeek + phase.currentDuration - 1;
                    
                    // Update phase week display in overview cards
                    const weekDisplay = document.getElementById(`phase-${phaseNum}-weeks`);
                    if (weekDisplay) {
                        weekDisplay.textContent = getPhaseDisplayDates(phase.startWeek, endWeek);
                    }
                    
                    // Update status badge
                    const statusBadge = document.getElementById(`phase-${phaseNum}-status-badge`);
                    if (statusBadge && phaseNum !== '2') { // Don't change Phase 2 as it's always Critical
                        if (isExtended) {
                            statusBadge.textContent = 'Behind';
                            statusBadge.className = 'text-xs bg-red-200 text-red-800 px-2 py-1';
                        } else {
                            statusBadge.textContent = 'Planned';
                            statusBadge.className = `text-xs bg-${phase.color}-200 text-${phase.color}-800 px-2 py-1`;
                        }
                    }
                    
                    // Update extended flag
                    const extendedFlag = document.getElementById(`phase-${phaseNum}-extended-flag`);
                    if (extendedFlag) {
                        if (isExtended) {
                            extendedFlag.classList.remove('hidden');
                        } else {
                            extendedFlag.classList.add('hidden');
                        }
                    }
                });
                
                // Update project end date
                updateProjectEndDate();
                checkScheduleImpact();
                
                // Update total duration display
                document.getElementById('total-duration').textContent = `${getTotalWeeks()} Week Duration`;
            }

            // Update project end date using work week calculation
            function updateProjectEndDate() {
                const startDateInput = document.getElementById('start-date');
                const endDateDisplay = document.getElementById('end-date-display');
                
                if (startDateInput.value) {
                    const startDate = new Date(startDateInput.value);
                    const totalWeeks = getTotalWeeks();
                    
                    // Calculate the Friday of the final work week
                    const endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + ((totalWeeks - 1) * 7));
                    // Adjust to Friday of that week
                    const dayOfWeek = endDate.getDay();
                    endDate.setDate(endDate.getDate() - dayOfWeek + 5); // 5 = Friday
                    
                    endDateDisplay.textContent = endDate.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                } else {
                    endDateDisplay.textContent = 'TBD';
                }
            }

            // Check for schedule impact and show alert
            function checkScheduleImpact() {
                const totalExtension = getTotalWeeks() - projectData.originalTotalWeeks;
                const impactAlert = document.getElementById('impact-alert');
                const impactDetails = document.getElementById('impact-details');
                
                if (totalExtension > 0) {
                    let impactText = `<p><strong>Project extended by ${totalExtension} week(s)</strong></p>`;
                    
                    Object.entries(projectData.phases).forEach(([phaseNum, phase]) => {
                        const extension = phase.currentDuration - phase.originalDuration;
                        if (extension > 0) {
                            impactText += `<p>• Phase ${phaseNum}: +${extension} week(s)</p>`;
                        }
                    });
                    
                    impactText += `<p class="mt-2"><strong>Payment milestones and completion dates have been automatically adjusted.</strong></p>`;
                    
                    impactDetails.innerHTML = impactText;
                    impactAlert.classList.remove('hidden');
                } else {
                    impactAlert.classList.add('hidden');
                }
            }

            // Recalculate phase start times
            function recalculatePhaseStarts(changedPhaseNum) {
                const phases = Object.keys(projectData.phases).sort((a, b) => parseInt(a) - parseInt(b));
                
                for (let i = 0; i < phases.length; i++) {
                    const phaseNum = phases[i];
                    if (parseInt(phaseNum) > parseInt(changedPhaseNum)) {
                        const prevPhaseNum = phases[i - 1];
                        const prevPhase = projectData.phases[prevPhaseNum];
                        projectData.phases[phaseNum].startWeek = prevPhase.startWeek + prevPhase.currentDuration;
                    }
                }
            }

            // Setup Gantt chart interactions
            function setupGanttInteractions() {
                let isDragging = false;
                let isResizing = false;
                let dragStartX = 0;
                let dragPhase = null;
                let originalDuration = 0;
                let originalLeft = 0;
                let containerWidth = 0;
                let totalWeeks = 0;

                // Attach event listeners to all Gantt bars and resize handles
                document.querySelectorAll('.gantt-bar').forEach(bar => {
                    const phaseNum = bar.getAttribute('data-phase');
                    
                    // Resize handle functionality
                    const resizeHandle = bar.querySelector('.resize-handle');
                    if (resizeHandle) {
                        resizeHandle.addEventListener('mousedown', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            isResizing = true;
                            dragPhase = phaseNum;
                            dragStartX = e.clientX;
                            originalDuration = projectData.phases[phaseNum].currentDuration;
                            containerWidth = bar.parentElement.offsetWidth;
                            totalWeeks = getTotalWeeks();
                            
                            bar.classList.add('dragging');
                            document.body.style.cursor = 'ew-resize';
                            
                            document.addEventListener('mousemove', handleResize);
                            document.addEventListener('mouseup', stopResize);
                        });
                    }
                });

                function handleResize(e) {
                    if (!isResizing || !dragPhase) return;
                    
                    const deltaX = e.clientX - dragStartX;
                    const effectiveWidth = containerWidth * 0.98; // Account for reserved space
                    const weekWidth = effectiveWidth / totalWeeks;
                    const weeksDelta = Math.round(deltaX / weekWidth);
                    
                    let newDuration = Math.max(1, Math.min(12, originalDuration + weeksDelta));
                    
                    if (newDuration !== projectData.phases[dragPhase].currentDuration) {
                        updatePhaseDuration(dragPhase, newDuration);
                    }
                }

                function stopResize() {
                    if (isResizing) {
                        isResizing = false;
                        dragPhase = null;
                        document.body.style.cursor = '';
                        
                        document.querySelectorAll('.gantt-bar').forEach(bar => {
                            bar.classList.remove('dragging');
                        });
                        
                        document.removeEventListener('mousemove', handleResize);
                        document.removeEventListener('mouseup', stopResize);
                        
                        showNotification('Phase duration updated successfully! Task progress preserved.', 'success');
                    }
                }

                // Prevent default drag behavior on images and other elements
                document.addEventListener('dragstart', function(e) {
                    if (e.target.closest('.gantt-bar')) {
                        e.preventDefault();
                    }
                });
            }

            // Setup event listeners
            function setupEventListeners() {
                // Gantt bar drag and resize functionality
                setupGanttInteractions();

                // Reset timeline button
                document.getElementById('reset-timeline').addEventListener('click', function() {
                    if (confirm('Reset all phases to original timeline? This will not affect task progress.')) {
                        // Save current task completion states
                        const savedStates = saveCheckboxStates();
                        
                        Object.keys(projectData.phases).forEach(phaseNum => {
                            projectData.phases[phaseNum].currentDuration = projectData.phases[phaseNum].originalDuration;
                        });
                        
                        // Reset start weeks
                        projectData.phases[1].startWeek = 1;
                        projectData.phases[2].startWeek = 5;
                        projectData.phases[3].startWeek = 9;
                        projectData.phases[4].startWeek = 13;
                        projectData.phases[5].startWeek = 17;
                        
                        generateWeekHeaders();
                        generateGanttChart();
                        generatePaymentMilestones();
                        updatePhaseDisplays();
                        
                        // Update total duration display
                        document.getElementById('total-duration').textContent = `${getTotalWeeks()} Week Duration`;
                        
                        // Restore task completion states
                        restoreCheckboxStates(savedStates);
                        
                        showNotification('Timeline reset to original schedule. Task progress preserved.', 'info');
                    }
                });

                // Reset progress button
                document.getElementById('reset-progress').addEventListener('click', function() {
                    if (confirm('Are you sure you want to reset all progress? This action cannot be undone.')) {
                        // Reset task progress
                        document.querySelectorAll('.task-checkbox, .architect-task').forEach(checkbox => {
                            checkbox.checked = false;
                            const taskItem = checkbox.closest('.task-item');
                            if (taskItem) {
                                taskItem.classList.remove('completed');
                            }
                        });
                        
                        // Reset payment progress
                        document.querySelectorAll('.payment-checkbox').forEach(checkbox => {
                            checkbox.checked = false;
                            checkbox.closest('.payment-milestone').classList.remove('completed');
                        });
                        
                        // Reset phase progress
                        Object.keys(projectData.phases).forEach(phaseNum => {
                            projectData.phases[phaseNum].completedTasks = 0;
                        });
                        
                        totalPaid = 0;
                        updateProgress();
                        updatePaymentDisplay();
                        showNotification('All progress has been reset.', 'info');
                    }
                });

                // Start date input
                document.getElementById('start-date').addEventListener('change', function() {
                    generateWeekHeaders();
                    generateGanttChart();
                    generatePaymentMilestones();
                    updateProjectEndDate();
                    showNotification('Project dates updated successfully!', 'success');
                });

                // Export timeline as PDF
                document.getElementById('export-timeline').addEventListener('click', function() {
                    generatePDFReport();
                    showNotification('PDF report generated - use your browser print dialog to save as PDF', 'success');
                });
            }

            // Update phase duration
            function updatePhaseDuration(phaseNum, newDuration) {
                // Save current task completion states
                const savedStates = saveCheckboxStates();
                
                projectData.phases[phaseNum].currentDuration = newDuration;
                recalculatePhaseStarts(phaseNum);
                generateWeekHeaders();
                generateGanttChart();
                generatePaymentMilestones();
                updatePhaseDisplays();
                
                // Update total duration display
                document.getElementById('total-duration').textContent = `${getTotalWeeks()} Week Duration`;
                
                // Restore task completion states
                restoreCheckboxStates(savedStates);
                
                showNotification(`Phase ${phaseNum} duration updated to ${newDuration} weeks. Task progress preserved.`, 'info');
            }

            // Attach task toggle listeners
            function attachTaskToggleListeners() {
                document.querySelectorAll('.task-toggle').forEach(toggle => {
                    toggle.addEventListener('click', function() {
                        const targetId = this.getAttribute('data-target');
                        const target = document.getElementById(targetId);
                        const icon = this.querySelector('i.fas');
                        
                        target.classList.toggle('open');
                        
                        if (icon) {
                            icon.classList.toggle('fa-caret-right');
                            icon.classList.toggle('fa-caret-down');
                        }
                    });
                });

                // Task checkbox functionality
                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const phase = parseInt(this.getAttribute('data-phase'));
                        const taskItem = this.closest('.task-item');
                        
                        if (this.checked) {
                            taskItem.classList.add('completed');
                            projectData.phases[phase].completedTasks++;
                        } else {
                            taskItem.classList.remove('completed');
                            projectData.phases[phase].completedTasks--;
                        }
                        
                        updateProgress();
                        animateProgressUpdate();
                    });
                });
            }

            // Attach payment listeners
            function attachPaymentListeners() {
                const paymentCheckboxes = document.querySelectorAll('.payment-checkbox');
                const paymentMilestoneCards = document.querySelectorAll('.payment-milestone');
                
                paymentMilestoneCards.forEach((card, index) => {
                    card.addEventListener('click', function() {
                        const checkbox = paymentCheckboxes[index];
                        const milestone = paymentMilestones[index];
                        
                        checkbox.checked = !checkbox.checked;
                        
                        if (checkbox.checked) {
                            totalPaid += milestone.amount;
                            card.classList.add('completed');
                        } else {
                            totalPaid -= milestone.amount;
                            card.classList.remove('completed');
                        }
                        
                        updatePaymentDisplay();
                    });
                });

                paymentCheckboxes.forEach((checkbox, index) => {
                    checkbox.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                    
                    checkbox.addEventListener('change', function() {
                        const milestone = paymentMilestones[index];
                        const milestoneElement = this.closest('.payment-milestone');
                        
                        if (this.checked) {
                            totalPaid += milestone.amount;
                            milestoneElement.classList.add('completed');
                        } else {
                            totalPaid -= milestone.amount;
                            milestoneElement.classList.remove('completed');
                        }
                        
                        updatePaymentDisplay();
                    });
                });
            }

            // Update progress display
            function updateProgress() {
                let totalCompleted = 0;
                
                Object.keys(projectData.phases).forEach(phaseNum => {
                    const phase = projectData.phases[phaseNum];
                    const phaseProgress = (phase.completedTasks / phase.totalTasks) * 100;
                    
                    const progressBar = document.getElementById(`phase-${phaseNum}-progress`);
                    if (progressBar) {
                        progressBar.style.width = phaseProgress + '%';
                    }
                    
                    const statusDisplay = document.getElementById(`phase-${phaseNum}-status`);
                    if (statusDisplay) {
                        statusDisplay.textContent = `${phase.completedTasks} of ${phase.totalTasks} tasks`;
                    }
                    
                    totalCompleted += phase.completedTasks;
                });
                
                const overallProgress = (totalCompleted / projectData.totalTasks) * 100;
                document.getElementById('overall-progress').style.width = overallProgress + '%';
                document.getElementById('progress-display').textContent = Math.round(overallProgress) + '%';
            }

            // Animate progress update
            function animateProgressUpdate() {
                const progressBars = document.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => {
                    bar.classList.add('progress-animation');
                    setTimeout(() => {
                        bar.classList.remove('progress-animation');
                    }, 500);
                });
            }

            // Update payment display
            function updatePaymentDisplay() {
                const remaining = 450000 - totalPaid;
                document.getElementById('total-payments').textContent = '$' + totalPaid.toLocaleString();
                document.getElementById('remaining-balance').textContent = '$' + remaining.toLocaleString();
            }

            // Generate professional PDF report
            function generatePDFReport() {
                const startDate = document.getElementById('start-date').value;
                const currentDate = new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Calculate overall progress
                const totalCompleted = Object.values(projectData.phases).reduce((sum, phase) => sum + phase.completedTasks, 0);
                const overallProgress = Math.round((totalCompleted / projectData.totalTasks) * 100);
                
                // Calculate project end date
                let projectEndDate = 'TBD';
                if (startDate) {
                    const start = new Date(startDate);
                    const totalWeeks = getTotalWeeks();
                    const end = new Date(start);
                    end.setDate(start.getDate() + ((totalWeeks - 1) * 7));
                    const dayOfWeek = end.getDay();
                    end.setDate(end.getDate() - dayOfWeek + 5); // Friday
                    projectEndDate = end.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                }
                
                // Generate phase summary table
                let phaseTableRows = '';
                Object.entries(projectData.phases).forEach(([phaseNum, phase]) => {
                    const phaseProgress = Math.round((phase.completedTasks / phase.totalTasks) * 100);
                    const endWeek = phase.startWeek + phase.currentDuration - 1;
                    const dateRange = getPhaseDisplayDates(phase.startWeek, endWeek);
                    const status = phase.completedTasks === phase.totalTasks ? 'Complete' : 
                                  phase.completedTasks > 0 ? 'In Progress' : 'Planned';
                    const statusClass = phase.completedTasks === phase.totalTasks ? 'status-complete' : 
                                       phase.completedTasks > 0 ? 'status-progress' : 'status-planned';
                    
                    phaseTableRows += `
                        <tr>
                            <td>Phase ${phaseNum}</td>
                            <td>${phase.name}</td>
                            <td>${dateRange}</td>
                            <td>${phase.currentDuration} weeks</td>
                            <td><span class="${statusClass}">${status}</span></td>
                            <td>${phaseProgress}%</td>
                            <td>${phase.budget}</td>
                        </tr>
                    `;
                });
                
                // Generate payment summary table
                let paymentTableRows = '';
                let totalPaidAmount = 0;
                paymentMilestones.forEach((milestone, index) => {
                    const checkbox = document.getElementById(milestone.id);
                    const isPaid = checkbox && checkbox.checked;
                    if (isPaid) totalPaidAmount += milestone.amount;
                    
                    const adjustedWeek = adjustPaymentMilestoneWeek(milestone.week);
                    const adjustedTiming = milestone.week === 0 ? milestone.timing : getPaymentMilestoneDate(adjustedWeek);
                    const statusClass = isPaid ? 'status-complete' : 'status-planned';
                    const statusText = isPaid ? 'Received' : 'Pending';
                    
                    paymentTableRows += `
                        <tr>
                            <td>${milestone.description}</td>
                            <td>${milestone.percentage}%</td>
                            <td>${milestone.amount.toLocaleString()}</td>
                            <td>${adjustedTiming}</td>
                            <td><span class="${statusClass}">${statusText}</span></td>
                        </tr>
                    `;
                });
                
                // Generate timeline summary
                const totalExtension = getTotalWeeks() - projectData.originalTotalWeeks;
                const timelineStatus = totalExtension > 0 ? 
                    `<span class="status-warning">Extended by ${totalExtension} week(s)</span>` : 
                    '<span class="status-complete">On Schedule</span>';
                
                // Create the PDF content
                const pdfContent = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>RSVP Gallery 2.0 - Project Timeline Report</title>
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            background: white;
                            padding: 40px;
                        }
                        
                        .header {
                            border-bottom: 3px solid #2563eb;
                            padding-bottom: 20px;
                            margin-bottom: 30px;
                        }
                        
                        .header h1 {
                            font-size: 28px;
                            color: #1e40af;
                            margin-bottom: 5px;
                        }
                        
                        .header .subtitle {
                            font-size: 16px;
                            color: #6b7280;
                            margin-bottom: 15px;
                        }
                        
                        .header-info {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            margin-top: 15px;
                        }
                        
                        .info-section h3 {
                            font-size: 14px;
                            color: #374151;
                            margin-bottom: 8px;
                            font-weight: 600;
                        }
                        
                        .info-section p {
                            font-size: 13px;
                            color: #6b7280;
                            margin-bottom: 4px;
                        }
                        
                        .executive-summary {
                            background: #f8fafc;
                            border: 1px solid #e2e8f0;
                            border-radius: 8px;
                            padding: 25px;
                            margin-bottom: 30px;
                        }
                        
                        .executive-summary h2 {
                            font-size: 20px;
                            color: #1e40af;
                            margin-bottom: 15px;
                        }
                        
                        .summary-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 20px;
                        }
                        
                        .summary-item {
                            text-align: center;
                            padding: 15px;
                            background: white;
                            border-radius: 6px;
                            border: 1px solid #e2e8f0;
                        }
                        
                        .summary-value {
                            font-size: 24px;
                            font-weight: bold;
                            color: #1e40af;
                            margin-bottom: 5px;
                        }
                        
                        .summary-label {
                            font-size: 12px;
                            color: #6b7280;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        }
                        
                        .section {
                            margin-bottom: 35px;
                        }
                        
                        .section h2 {
                            font-size: 18px;
                            color: #1e40af;
                            margin-bottom: 15px;
                            padding-bottom: 8px;
                            border-bottom: 2px solid #e2e8f0;
                        }
                        
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 10px;
                            font-size: 12px;
                        }
                        
                        th {
                            background: #f1f5f9;
                            color: #334155;
                            font-weight: 600;
                            padding: 12px 8px;
                            text-align: left;
                            border-bottom: 2px solid #e2e8f0;
                        }
                        
                        td {
                            padding: 10px 8px;
                            border-bottom: 1px solid #f1f5f9;
                        }
                        
                        tr:nth-child(even) {
                            background: #fafafa;
                        }
                        
                        .status-complete {
                            background: #dcfce7;
                            color: #166534;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            font-weight: 500;
                        }
                        
                        .status-progress {
                            background: #fef3c7;
                            color: #92400e;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            font-weight: 500;
                        }
                        
                        .status-planned {
                            background: #e0e7ff;
                            color: #3730a3;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            font-weight: 500;
                        }
                        
                        .status-warning {
                            background: #fee2e2;
                            color: #991b1b;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            font-weight: 500;
                        }
                        
                        .footer {
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #e2e8f0;
                            text-align: center;
                            font-size: 11px;
                            color: #6b7280;
                        }
                        
                        @media print {
                            body {
                                padding: 20px;
                                font-size: 11px;
                            }
                            
                            .header h1 {
                                font-size: 24px;
                            }
                            
                            .executive-summary h2,
                            .section h2 {
                                font-size: 16px;
                            }
                            
                            .summary-value {
                                font-size: 20px;
                            }
                            
                            table {
                                font-size: 10px;
                            }
                            
                            th, td {
                                padding: 6px 4px;
                            }
                            
                            @page {
                                size: letter;
                                margin: 0.75in;
                            }
                            
                            .section {
                                page-break-inside: avoid;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>RSVP Gallery 2.0</h1>
                        <div class="subtitle">Project Timeline & Progress Report</div>
                        
                        <div class="header-info">
                            <div class="info-section">
                                <h3>Project Information</h3>
                                <p><strong>Location:</strong> 212 N Aberdeen Street, Chicago, IL</p>
                                <p><strong>Area:</strong> 3,855 Square Feet</p>
                                <p><strong>Budget:</strong> $450,000</p>
                                <p><strong>Duration:</strong> ${getTotalWeeks()} Weeks</p>
                            </div>
                            <div class="info-section">
                                <h3>Project Team</h3>
                                <p><strong>Architect:</strong> Norman Kelley Architecture</p>
                                <p><strong>General Contractor:</strong> ChiLab Studio LLC</p>
                                <p><strong>Subcontractor:</strong> Max Davis Group</p>
                                <p><strong>Report Date:</strong> ${currentDate}</p>
                            </div>
                        </div>
                    </div>

                    <div class="executive-summary">
                        <h2>Executive Summary</h2>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-value">${overallProgress}%</div>
                                <div class="summary-label">Overall Progress</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${totalCompleted}</div>
                                <div class="summary-label">Tasks Completed</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${totalPaidAmount.toLocaleString()}</div>
                                <div class="summary-label">Payments Received</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${timelineStatus}</div>
                                <div class="summary-label">Schedule Status</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Project Timeline</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Phase</th>
                                    <th>Description</th>
                                    <th>Date Range</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Budget</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${phaseTableRows}
                            </tbody>
                        </table>
                    </div>

                    <div class="section">
                        <h2>Payment Schedule</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Milestone</th>
                                    <th>Percentage</th>
                                    <th>Amount</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${paymentTableRows}
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 6px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 13px;">
                                <div><strong>Total Payments Received:</strong> ${totalPaidAmount.toLocaleString()}</div>
                                <div><strong>Remaining Balance:</strong> ${(450000 - totalPaidAmount).toLocaleString()}</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Project Dates</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Milestone</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Project Start</td>
                                    <td>${startDate ? new Date(startDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'TBD'}</td>
                                    <td><span class="${startDate ? 'status-complete' : 'status-planned'}">${startDate ? 'Scheduled' : 'Pending'}</span></td>
                                </tr>
                                <tr>
                                    <td>Project Completion</td>
                                    <td>${projectEndDate}</td>
                                    <td><span class="status-planned">Projected</span></td>
                                </tr>
                                <tr>
                                    <td>Original Duration</td>
                                    <td>${projectData.originalTotalWeeks} weeks</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Current Duration</td>
                                    <td>${getTotalWeeks()} weeks</td>
                                    <td>${timelineStatus}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="footer">
                        <p>Generated by ChiLab Studio Project Management System • ${currentDate}</p>
                        <p>This report reflects project status as of the report generation date.</p>
                    </div>
                </body>
                </html>
                `;
                
                // Open in new window for printing
                const printWindow = window.open('', '_blank');
                printWindow.document.write(pdfContent);
                printWindow.document.close();
                
                // Auto-trigger print dialog after content loads
                printWindow.onload = function() {
                    setTimeout(() => {
                        printWindow.print();
                    }, 500);
                };
            }
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500'
                };
                
                notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        ${message}
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // Initialize the application
            initializeTimeline();
        });
    </script>
</body>
</html>
